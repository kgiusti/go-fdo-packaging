Using go-vendor-tools
=====================

Kudos to Miguel Martin for figuring this out:

The spec file can be generated by go2rpm. go2rpm uses go-vendor-tools
to generate a source tar of the dependencies. These vendored
dependencies can be managed using the go-vendor-tools toolset.

Install the necessary go vendor tooling:

`$ dnf install go2rpm scancode-toolkit go-vendor-tools+scancode`

Create a config file for the go-vendor-tools called _go-vendor-tools.toml_
Refer to https://fedora.gitlab.io/sigs/go/go-vendor-tools for documentation.

A basic config file:

`$ cat go-vendor-tools.toml`
```
[archive]
compression_type = "bz2"

[licensing]
detector = "scancode"

[licensing.detector_config]
multiple = "true"
```

No un the go2rpm command using the _vendor_ profile:

`$ go2rpm --download --name go-fdo-server --profile vendor github.com/fido-device-onboard/go-fdo-server`

This will result in generating the specfile, downloading the projects
source tarball, and another tarball of the vendored dependencies.

Fixup the resultant specfile: make sure the for loop in the
%build section is commented or removed, add GO111MODULE=on,
fixup #FIXMEs, etc.

```
%build
%global gomodulesmode GO111MODULE=on
#for cmd in cmd/* ; do
#  %gobuild -o %{gobuilddir}/bin/$(basename $cmd) %{goipath}/$cmd
#done
%gobuild -o %{gobuilddir}/bin/go-fdo-server %{goipath}
```

Copy the two tarfiles created by the go2rpm command (one contains the
target sources, the other the vendored sources) to your
rpmbuild/SOURCES directory.

Copy the _go-vendor-tools.toml_ file to the SOURCES directory as well.

Copy the _go-fdo-server.spec_ file to the rpmbuild/SPECS file.

You should be able to build the rpm, as well as the source rpm:

```
$ rpmbuild -bb rpmbuild/SPECS/go-fdo-server.spec
$ rpmbuild -bs rpmbuild/SPECS/go-fdo-server.spec
```

*note* the above is clunky.  there must be a better way of doing that.
